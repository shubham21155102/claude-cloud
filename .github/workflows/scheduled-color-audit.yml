name: Scheduled Dark Mode Color Audit

on:
  schedule:
    # Runs every 30 minutes
    - cron: '*/30 * * * *'
  workflow_dispatch:
    # Allow manual triggering for testing

jobs:
  color-audit:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout claude-cloud
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install dependencies
        run: |
          npm install
          npm install -g @anthropic-ai/claude-code
          npm link

      - name: Configure Claude Cloud
        env:
          GH_USERNAME: ${{ secrets.GH_USERNAME }}
          GH_EMAIL: ${{ secrets.GH_EMAIL }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
          ZAI_API_KEY: ${{ secrets.ZAI_API_KEY }}
        run: |
          # Create the config file manually in the home directory
          cat <<EOF > $HOME/.claude-cloud-config.json
          {
            "githubUsername": "$GH_USERNAME",
            "githubEmail": "$GH_EMAIL",
            "githubToken": "$GH_TOKEN",
            "zaiApiKey": "$ZAI_API_KEY",
            "workDir": "$GITHUB_WORKSPACE/temp_repos"
          }
          EOF

      - name: Run Dark Mode Color Audit
        env:
          ANTHROPIC_DEFAULT_OPUS_MODEL: GLM-4.7
          ORG_NAME: Grassstone-AI-Pvt-Ltd
          REPO_NAME: rp360-frontend
          CLAUDE_CLOUD_ISSUE: |
            IMPORTANT: Checkout and work on the existing branch 'feature/dark-mode-color-audit' for all your changes. Do not create a new branch.

            Continue the dark mode color audit work. Your task:

            1. First, checkout the branch: git checkout feature/dark-mode-color-audit
            2. Pull latest changes: git pull origin feature/dark-mode-color-audit
            3. Continue auditing TypeScript/TSX files for hardcoded colors (find files using grep or search tools)
            4. Replace hex colors with CSS variables following these patterns:
               - #1C1D21 â†’ var(--text-primary)
               - #747778 / #8181A5 / #666 â†’ var(--text-secondary)
               - #C4C7C7 â†’ var(--text-muted)
               - #d4d0d0 / #e3e3e3 / #e5e7eb â†’ var(--border-color)
               - #f8f8f8 / #f3f3f3 / #F5F5FA â†’ var(--bg-hover) or var(--bg-main)
               - #fff â†’ var(--bg-card) (where applicable)
               - #5E81F4 / #4F6BED â†’ var(--accent-primary)
            5. KEEP semantic colors for data visualization (greens, reds, status colors)
            6. Create or update the progress.md file in the repository root with:
               - Session timestamp
               - Files completed in this session
               - Detailed list of changes made
               - Remaining work count (search for remaining hex colors)
            7. Commit your changes with a clear message
            8. Push to the feature/dark-mode-color-audit branch

            Work systematically through the remaining files. Focus on completing 10-20 files per session.
          CLAUDE_CLOUD_SHOW_LOGS: 'true'
        run: |
          echo "ðŸŽ¨ Starting scheduled dark mode color audit..."
          echo "ðŸ“… Run time: $(date)"
          claude-cloud contribute --org "$ORG_NAME" --repo "$REPO_NAME"

      - name: Upload Claude logs
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: color-audit-logs-${{ github.run_id }}
          path: ${{ github.workspace }}/temp_repos/*/.claude-logs.txt
          if-no-files-found: ignore

      - name: Upload progress report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: progress-report-${{ github.run_id }}
          path: ${{ github.workspace }}/temp_repos/*/progress.md
          if-no-files-found: ignore
